<!--
This code was generated by @basketry/react-query@{{version}}

Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.

To make changes to the contents of this file:
1. Edit source/path.ext
2. Run the Basketry CLI

About Basketry: https://basketry.io
About @basketry/react-query: https://basketry.io/docs/components/@basketry/react-query
-->

# React Query Hooks

This directory contains the generated React Query hooks that provide access to the BasketryExample v1 API.

For more information about React Query, [read the official docs](https://tanstack.com/query/latest/docs/framework/react/overview).

## Setup

Wrap your application in the `BasketryExampleProvider` exported from the `context` module. This provides implementations of the interfaces that empower the query and mutation hooks.

```tsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { BasketryExampleProvider } from './v1/hooks/context';

export const App = () => {
  const queryClient = new QueryClient();

  return (
    <BasketryExampleProvider root="/v1">
      <QueryClientProvider client={queryClient}>
        <div>Your app goes here</div>
      </QueryClientProvider>
    </BasketryExampleProvider>
  );
};
```

Note that the `BasketryExampleProvider` _DOES NOT_ automatically service as a Tanstack `QueryClientProvider`. You will also need to wrap your component tree in a `QueryClientProvider`. It doesn't matter which order you wrap the components, but both are required.

## Queries

See: [Tanstack Query docs for Queries](https://tanstack.com/query/latest/docs/framework/react/guides/queries)

Each query hook is the equivalent of the general `useQuery` hook with the method-specific `queryFn`, `select`, and `queryKey` properties provided.

```tsx
import { useGizmos } from './v1/hooks/gizmos';

export const Example = () => {
  const { data, isLoading } = useGizmos({
    /* params */
  });

  // Use `isLoading` value to display a loading indicator
  if (isLoading) return <div>Loading ...</div>;

  // Use `data` value to display the response
  return (
    <div>
      <h1>Here is your data:</h1>
      <pre>{JSON.stringify(data, null, 2)}</pre>
    </div>
  );
};
```

### Suspense

See: [Tanstack Query docs for Suspense](https://tanstack.com/query/latest/docs/framework/react/guides/suspense)

React Query can also be used with React's Suspense for Data Fetching API's. Each generated query hook has a Suspense variant that can be used in place of the standard hook.

```tsx
import { useSuspenseGizmos } from './v1/hooks/gizmos';

export const ExampleContainer = () => (
  // Use suspense to display a loading indicator
  <React.Suspense fallback={<div>Loading...</div>}>
    <Example />
  </React.Suspense>
);

export const Example = () => {
  const { data } = useSuspenseGizmos({
    /* params */
  });

  // Use `data` value to display the response
  return (
    <div>
      <h1>Here is your data:</h1>
      <pre>{JSON.stringify(data, null, 2)}</pre>
    </div>
  );
};
```

### QueryClient Overrides

Both the standard and suspense hooks can be called with optional client overrides. These options are only applied to the specific query and do not affect the global QueryClient.

```tsx
const { data } = useGizmos(
  {
    /* params */
  },
  { retry: 5, retryDelay: 1000 },
);

const { data } = useSuspenseGizmos(
  {
    /* params */
  },
  { retry: 5, retryDelay: 1000 },
);
```

## Mutations

See: [Tanstack Query docs for Mutations](https://tanstack.com/query/latest/docs/framework/react/guides/mutations)

```tsx
import { useUpdateGizmo } from './v1/hooks/gizmos';

export const Example = () => {
  const { mutate } = useUpdateGizmo({
    onSuccess: (data, variables) => {
      console.log('called with variables', variables);
      console.log('returned data', data);
    },
    onError: console.error,
  });

  const handleClick = useCallback(() => {
    mutate({
      /* params */
    });
  }, [mutate]);

  return (
    <div>
      <button onClick={handleClick}>Update gizmo</button>
    </div>
  );
};
```

## Error Handling

React Query returns an `error` property from the query and mutation hooks. This value is non-null when an error has been raised.

The generated hooks return an error of type `QueryError<T>` where `T` is the type of error returned from the API method. This error type is a discriminated union of either a handled or unhandled error.

Handled errors will be of type `T` and are generally things like validation errors returned in a structurd format from the API. Unhandled errors are of type `unknown` generally represent exceptions thrown during the execution of the API or the processing of the response.

## Services

The generated hooks make use of the generated HTTP Client service implementations. While hooks provide a React-idiomatic mechanism for interacting with your API, the raw service implmentations provide more precise, fine-gained control.

Using the generated React Query hooks will be sufficient for most use cases; however, the services can be access from within the `BasketryExampleProvider` tree by using the hooks exported from the `context` module.

```tsx
import { useCallback } from 'react';
import { useGizmoService } from './v1/hooks/context';

export const Example = () => {
  const gizmoService = useGizmoService();

  const handleClick = useCallback(() => {
    // Do something directly with the gizmo service
  }, [gizmoService]);

  return (
    <div>
      <button onClick={handleClick}>Custom action</button>
    </div>
  );
};
```
